<!doctype html>

<html lang="en">

<head>
    <meta charset="utf-8">

    <title>K-Means in JavaScript</title>
    <meta name="description" content="K-Means in JavaScript">
    <meta name="author" content="Ezward">

    <!-- kmeans and plugins -->
    <script src="kmeans.js"></script>
    <script src="kmeanspp.js"></script>
    <script src="kmeansRandomInitializer.js"></script>
    <script src="kmeansRandomModel.js"></script>
    <script src="iris.js"></script>

    <!-- third party includes -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.js"></script>

    <style>
        #container
        {
            position: absolute;
            top: 5%;
            left: 5%;
            bottom: 5%;
            right: 5%;
        }

        #container canvas
        {
            position: relative;
            width: 100%;
            height: 100%;
        }
    </style>

</head>
    <div id="container">
        <canvas></canvas>
    </div>

    <script>
        /**
         * @public
         * Load iris dataset and run kmeans on it given the number of clusters
         * 
         * @param {integer} k number of clusters to create
         */
        function clusterIrisData(k) {
            //
            // map iris data rows from dictionary to vector (array), leaving out the label
            //
            const observations = com.lumpofcode.dataset.iris.map(x => [x.sepalLength, x.sepalWidth, x.petalLength, x.petalWidth]);
            const n = observations.length;

            //
            // create the intial model and run it
            //
            // const initialModel = com.lumpofcode.kmeans.randomCentroidInitializer(observations, k);
            const initialModel = com.lumpofcode.kmeans.kppInitializer(observations, k);
            const results = com.lumpofcode.kmeans.cluster(initialModel);
            console.dir(results, {depth: null, colors: true})

            // 
            // for the purposes of plotting in 2 dimensions, we will use 
            // x = sepalLength and y = sepalWidth, so map the 
            // observations into those 2 dimensions while
            // putting data points into clusters using the assignments
            //
            const clusters = [];
            for(let i = 0; i < k; i += 1) {
                clusters.push([])
            }
            for(let i = 0; i < n; i += 1) {
                clusters[results.model.assignments[i]].push({'x': results.model.observations[i][0], 'y': results.model.observations[i][1]});
            }
            console.dir(clusters, {depth: null, colors: true})

            //
            // plot the clusters
            //
            const colors = ['red', 'green', 'blue', 'yellow', 'purple', 'cyan', 'magenta'];
            const canvas = document.querySelector("#container canvas");
            const chart = new Chart(canvas, {
                type: 'scatter',
                data: {
                    datasets: clusters.map(function(x, i) { 
                        return {
                            label: "cluster" + i,
                            data: x,
                            backgroundColor: colors[i % colors.length],
                            pointBackgroundColor: colors[i % colors.length]
                        };
                    })
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    title: {
                        display: true,
                        text: 'Iris data set clustered using K-Means'
                    },
                    legend: {
                        position: 'bottom',
                        display: true
                    },
                    scales: {
                        xAxes: [{
                            type: 'linear',
                            position: 'bottom',
                            scaleLabel: {
                                labelString: 'sepal length in cm',
                                display: true,
                            }
                        }],
                        yAxes: [{
                            type: 'linear',
                            position: 'left',
                            scaleLabel: {
                                labelString: 'sepal width in cm',
                                display: true
                            }
                        }]
                    }
                }
            });
        }
        clusterIrisData(3);
    </script>

<body>
</body>

</html>